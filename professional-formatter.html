<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Document Formatter</title>
    <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1650px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #888;
            font-size: 0.95rem;
        }

        /* Quick Reference Bar */
        .quick-reference {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .quick-reference-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .quick-reference-title {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-reference-toggle {
            color: #667eea;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quick-reference-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(102, 126, 234, 0.2);
        }

        .quick-reference-content.show {
            display: block;
        }

        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 12px;
        }

        .command-group {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 12px;
        }

        .command-group h4 {
            color: #f093fb;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .command-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .command-item:last-child {
            margin-bottom: 0;
        }

        .command-syntax {
            background: rgba(240, 147, 251, 0.15);
            color: #f093fb;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            white-space: nowrap;
            min-width: fit-content;
        }

        .command-desc {
            color: #aaa;
            line-height: 1.3;
        }

        .command-result {
            color: #00ff88;
            font-size: 10px;
        }

        .auto-detect-badge {
            background: linear-gradient(135deg, #00ff88, #00d9ff);
            color: #1a1a2e;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: bold;
            margin-left: 5px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 75vh;
            overflow-y: auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel.preview-panel {
            border-left: 4px solid #00ff88;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .panel-title {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #00ff88;
        }

        .panel-title svg {
            width: 20px;
            height: 20px;
        }

        /* Content Block Styles */
        .content-block {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: all 0.3s;
        }

        .content-block:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .content-block.text-block {
            border-left: 4px solid #667eea;
        }

        .content-block.code-block {
            border-left: 4px solid #f093fb;
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .block-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .block-label.text-label {
            color: #667eea;
        }

        .block-label.code-label {
            color: #f093fb;
        }

        .block-label svg {
            width: 14px;
            height: 14px;
        }

        .block-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .block-actions select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 4px 8px;
            color: #e0e0e0;
            font-size: 11px;
            cursor: pointer;
        }

        .block-actions select:focus {
            outline: none;
            border-color: #f093fb;
        }

        .move-btn, .remove-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            width: 26px;
            height: 26px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .move-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }

        .remove-btn:hover {
            background: rgba(255, 71, 87, 0.3);
            color: #ff4757;
        }

        .move-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            color: #e0e0e0;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
        }

        .text-block textarea {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 200px;
            line-height: 1.6;
        }

        .text-block textarea:focus {
            border-color: #667eea;
        }

        .code-block textarea {
            font-family: 'Consolas', 'Monaco', 'Fira Code', monospace;
            height: 160px;
        }

        .code-block textarea:focus {
            border-color: #f093fb;
        }

        textarea::placeholder {
            color: #555;
            font-size: 12px;
        }

        /* Add Block Buttons */
        .add-block-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
        }

        .add-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-btn svg {
            width: 16px;
            height: 16px;
        }

        .add-text-btn {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .add-text-btn:hover {
            background: rgba(102, 126, 234, 0.35);
            transform: translateY(-2px);
        }

        .add-code-btn {
            background: rgba(240, 147, 251, 0.2);
            color: #f093fb;
            border: 1px solid rgba(240, 147, 251, 0.3);
        }

        .add-code-btn:hover {
            background: rgba(240, 147, 251, 0.35);
            transform: translateY(-2px);
        }

        /* Preview Area */
        .preview-area {
            width: 100%;
            min-height: 550px;
            max-height: 72vh;
            background: #ffffff;
            border-radius: 12px;
            padding: 35px 40px;
            color: #333;
            overflow-y: auto;
            font-family: 'Georgia', 'Times New Roman', serif;
        }

        .preview-area h1 {
            font-size: 2rem;
            color: #1a1a2e;
            -webkit-text-fill-color: #1a1a2e;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .preview-area h2 {
            font-size: 1.5rem;
            color: #302b63;
            margin: 30px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
            font-weight: 600;
        }

        .preview-area h3 {
            font-size: 1.2rem;
            color: #24243e;
            margin: 25px 0 12px 0;
            font-weight: 600;
        }

        .preview-area h4 {
            font-size: 1.05rem;
            color: #444;
            margin: 20px 0 10px 0;
            font-weight: 600;
            font-style: italic;
        }

        .preview-area p {
            margin-bottom: 16px;
            line-height: 1.8;
            text-align: justify;
            font-size: 1rem;
        }

        .preview-area .preview-code-block {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            overflow-x: auto;
            border-left: 5px solid #f093fb;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .preview-area .preview-code-block pre {
            margin: 0;
            font-family: 'Consolas', 'Monaco', 'Fira Code', monospace;
            font-size: 13px;
            color: #d4d4d4;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }

        .preview-area .preview-code-block .lang-label {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: #fff;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 10px;
            margin-bottom: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Segoe UI', sans-serif;
        }

        .preview-area ul, .preview-area ol {
            margin: 15px 0 15px 30px;
        }

        .preview-area li {
            margin-bottom: 10px;
            line-height: 1.7;
        }

        .preview-area blockquote {
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            margin: 20px 0;
            color: #444;
            font-style: italic;
            background: linear-gradient(135deg, #f8f7ff 0%, #f0f4ff 100%);
            border-radius: 0 10px 10px 0;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.1);
        }

        .preview-area blockquote.warning {
            border-left-color: #ff6b6b;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
        }

        .preview-area blockquote.success {
            border-left-color: #00d9a4;
            background: linear-gradient(135deg, #f0fff9 0%, #e0fff4 100%);
        }

        .preview-area hr {
            border: none;
            border-top: 2px solid #eee;
            margin: 30px 0;
        }

        .preview-area strong {
            color: #1a1a2e;
            font-weight: 700;
        }

        .preview-area em {
            color: #555;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 9px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn svg {
            width: 14px;
            height: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-family: 'Segoe UI', sans-serif;
        }

        .empty-state svg {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            opacity: 0.4;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
        }

        .block-number {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 6px;
        }

        .detection-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            display: none;
        }

        .content-block:hover .detection-indicator {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÑ Professional Document Formatter</h1>
            <p class="subtitle">Smart auto-detection ‚Ä¢ Professional formatting ‚Ä¢ Export to Word</p>
        </header>

        <!-- Quick Reference Section -->
        <div class="quick-reference">
            <div class="quick-reference-header" onclick="toggleReference()">
                <span class="quick-reference-title">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Formatting Guide
                    <span class="auto-detect-badge">SMART AUTO-DETECT</span>
                </span>
                <span class="quick-reference-toggle">
                    <span id="toggleText">Show</span>
                    <svg id="toggleIcon" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="transition: transform 0.3s;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </span>
            </div>
            <div class="quick-reference-content" id="referenceContent">
                <div class="commands-grid">
                    <!-- Auto-Detected Headings -->
                    <div class="command-group">
                        <h4>üìå Headings (Auto-Detected)</h4>
                        <div class="command-item">
                            <span class="command-syntax">ALL CAPS</span>
                            <span class="command-desc">Main Title (H1)</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">Title Case</span>
                            <span class="command-desc">Section Heading (H2)</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">Text:</span>
                            <span class="command-desc">Sub-section (H3)</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">1. Section</span>
                            <span class="command-desc">Numbered Heading</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">Introduction</span>
                            <span class="command-desc">Common section names auto-detected</span>
                        </div>
                    </div>

                    <!-- Lists -->
                    <div class="command-group">
                        <h4>üìù Lists</h4>
                        <div class="command-item">
                            <span class="command-syntax">- Item</span>
                            <span class="command-desc">Bullet point</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">* Item</span>
                            <span class="command-desc">Bullet point (alt)</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">‚Ä¢ Item</span>
                            <span class="command-desc">Bullet point (symbol)</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">1. Item</span>
                            <span class="command-desc">Numbered list</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">a) Item</span>
                            <span class="command-desc">Lettered list</span>
                        </div>
                    </div>

                    <!-- Quotes & Callouts -->
                    <div class="command-group">
                        <h4>üí¨ Quotes & Callouts</h4>
                        <div class="command-item">
                            <span class="command-syntax">> text</span>
                            <span class="command-desc">Blockquote</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">> Note:</span>
                            <span class="command-desc">Info callout</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">> Important:</span>
                            <span class="command-desc">Warning callout</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">> Warning:</span>
                            <span class="command-desc">Alert callout</span>
                        </div>
                    </div>

                    <!-- Formatting -->
                    <div class="command-group">
                        <h4>‚ú® Text Formatting</h4>
                        <div class="command-item">
                            <span class="command-syntax">**bold**</span>
                            <span class="command-desc">Bold text</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">*italic*</span>
                            <span class="command-desc">Italic text</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">---</span>
                            <span class="command-desc">Horizontal line</span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">[blank line]</span>
                            <span class="command-desc">Paragraph break</span>
                        </div>
                    </div>

                    <!-- Smart Detection -->
                    <div class="command-group">
                        <h4>üß† Smart Detection</h4>
                        <div class="command-item" style="flex-direction: column; gap: 4px;">
                            <span class="command-desc" style="font-size: 11px;">
                                ‚úì Common section names: Introduction, Overview, Summary, Conclusion, Methods, Results, Discussion, Background, Requirements, Implementation, Features, Benefits, Objectives<br><br>
                                ‚úì Short lines (< 50 chars) without punctuation ‚Üí Heading<br><br>
                                ‚úì Lines followed by longer content ‚Üí Heading<br><br>
                                ‚úì Numbered sections: "1. Title", "Chapter 1:" ‚Üí Heading
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Input Section -->
            <div class="input-section">
                <div class="panel" style="padding: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #888; font-size: 12px;">üìã Content Blocks</span>
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="clearAll()" style="padding: 5px 10px; font-size: 11px;">
                                Clear All
                            </button>
                            <button class="btn btn-secondary" onclick="loadSample()" style="padding: 5px 10px; font-size: 11px;">
                                Load Sample
                            </button>
                        </div>
                    </div>
                </div>

                <div id="blocksContainer">
                    <!-- Dynamic blocks will be added here -->
                </div>

                <div class="add-block-container">
                    <button class="add-btn add-text-btn" onclick="addTextBlock()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Text Block
                    </button>
                    <button class="add-btn add-code-btn" onclick="addCodeBlock()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Code Block
                    </button>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="panel preview-panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        Live Preview
                    </span>
                    <button class="btn btn-primary" onclick="exportToDoc()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        Export .DOCX
                    </button>
                </div>
                <div class="preview-area" id="previewArea">
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <p>Click "Add Text Block" or "Add Code Block" to start</p>
                        <p style="font-size: 12px; color: #777;">Smart formatting will auto-detect your content structure</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let blockCounter = 0;
        const blocksContainer = document.getElementById('blocksContainer');

        // Common section heading keywords
        const sectionKeywords = [
            'introduction', 'overview', 'summary', 'conclusion', 'conclusions',
            'abstract', 'background', 'methods', 'methodology', 'results',
            'discussion', 'references', 'appendix', 'acknowledgements',
            'requirements', 'implementation', 'architecture', 'design',
            'features', 'benefits', 'objectives', 'goals', 'scope',
            'prerequisites', 'installation', 'configuration', 'usage',
            'examples', 'troubleshooting', 'faq', 'glossary', 'index',
            'preface', 'foreword', 'contents', 'figures', 'tables',
            'analysis', 'evaluation', 'testing', 'deployment', 'maintenance',
            'security', 'performance', 'scalability', 'limitations',
            'future work', 'related work', 'literature review', 'problem statement',
            'proposed solution', 'system overview', 'technical approach',
            'key features', 'main features', 'core features', 'highlights',
            'getting started', 'quick start', 'setup', 'dependencies'
        ];

        // Toggle reference panel
        function toggleReference() {
            const content = document.getElementById('referenceContent');
            const toggleText = document.getElementById('toggleText');
            const toggleIcon = document.getElementById('toggleIcon');
            
            content.classList.toggle('show');
            
            if (content.classList.contains('show')) {
                toggleText.textContent = 'Hide';
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                toggleText.textContent = 'Show';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize with one text block
        window.addEventListener('load', () => {
            addTextBlock();
        });

        function addTextBlock(content = '') {
            blockCounter++;
            const blockId = blockCounter;
            
            const block = document.createElement('div');
            block.className = 'content-block text-block';
            block.dataset.id = blockId;
            block.dataset.type = 'text';
            block.innerHTML = `
                <span class="detection-indicator">üß† Auto-detect ON</span>
                <div class="block-header">
                    <span class="block-label text-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Text Block
                        <span class="block-number">#${blockId}</span>
                    </span>
                    <div class="block-actions">
                        <button class="move-btn" onclick="moveBlockUp(this)" title="Move Up">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                            </svg>
                        </button>
                        <button class="move-btn" onclick="moveBlockDown(this)" title="Move Down">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <button class="remove-btn" onclick="removeBlock(this)" title="Remove">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <textarea placeholder="Just paste or type your text naturally...

The system will automatically detect:
‚Ä¢ Headings and subheadings
‚Ä¢ Bullet and numbered lists
‚Ä¢ Quotes and callouts
‚Ä¢ Paragraphs and sections

No special formatting required!" oninput="updatePreview()">${content}</textarea>
            `;
            
            blocksContainer.appendChild(block);
            updateMoveButtons();
            updatePreview();
            
            block.querySelector('textarea').focus();
        }

        function addCodeBlock(lang = 'javascript', content = '') {
            blockCounter++;
            const blockId = blockCounter;
            
            const block = document.createElement('div');
            block.className = 'content-block code-block';
            block.dataset.id = blockId;
            block.dataset.type = 'code';
            block.innerHTML = `
                <div class="block-header">
                    <span class="block-label code-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                        </svg>
                        Code Block
                        <span class="block-number">#${blockId}</span>
                    </span>
                    <div class="block-actions">
                        <select onchange="updatePreview()">
                            <option value="javascript" ${lang === 'javascript' ? 'selected' : ''}>JavaScript</option>
                            <option value="python" ${lang === 'python' ? 'selected' : ''}>Python</option>
                            <option value="java" ${lang === 'java' ? 'selected' : ''}>Java</option>
                            <option value="c" ${lang === 'c' ? 'selected' : ''}>C</option>
                            <option value="cpp" ${lang === 'cpp' ? 'selected' : ''}>C++</option>
                            <option value="csharp" ${lang === 'csharp' ? 'selected' : ''}>C#</option>
                            <option value="html" ${lang === 'html' ? 'selected' : ''}>HTML</option>
                            <option value="css" ${lang === 'css' ? 'selected' : ''}>CSS</option>
                            <option value="sql" ${lang === 'sql' ? 'selected' : ''}>SQL</option>
                            <option value="bash" ${lang === 'bash' ? 'selected' : ''}>Bash/Shell</option>
                            <option value="json" ${lang === 'json' ? 'selected' : ''}>JSON</option>
                            <option value="xml" ${lang === 'xml' ? 'selected' : ''}>XML</option>
                            <option value="typescript" ${lang === 'typescript' ? 'selected' : ''}>TypeScript</option>
                            <option value="php" ${lang === 'php' ? 'selected' : ''}>PHP</option>
                            <option value="ruby" ${lang === 'ruby' ? 'selected' : ''}>Ruby</option>
                            <option value="go" ${lang === 'go' ? 'selected' : ''}>Go</option>
                            <option value="rust" ${lang === 'rust' ? 'selected' : ''}>Rust</option>
                            <option value="swift" ${lang === 'swift' ? 'selected' : ''}>Swift</option>
                            <option value="kotlin" ${lang === 'kotlin' ? 'selected' : ''}>Kotlin</option>
                            <option value="code" ${lang === 'code' ? 'selected' : ''}>Other</option>
                        </select>
                        <button class="move-btn" onclick="moveBlockUp(this)" title="Move Up">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                            </svg>
                        </button>
                        <button class="move-btn" onclick="moveBlockDown(this)" title="Move Down">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <button class="remove-btn" onclick="removeBlock(this)" title="Remove">
                            <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <textarea placeholder="Paste your code here..." oninput="updatePreview()">${content}</textarea>
            `;
            
            blocksContainer.appendChild(block);
            updateMoveButtons();
            updatePreview();
            
            block.querySelector('textarea').focus();
        }

        function removeBlock(btn) {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            if (blocks.length > 1) {
                btn.closest('.content-block').remove();
                updateMoveButtons();
                updatePreview();
            } else {
                showToast('Need at least one block', true);
            }
        }

        function moveBlockUp(btn) {
            const block = btn.closest('.content-block');
            const prev = block.previousElementSibling;
            if (prev) {
                blocksContainer.insertBefore(block, prev);
                updateMoveButtons();
                updatePreview();
            }
        }

        function moveBlockDown(btn) {
            const block = btn.closest('.content-block');
            const next = block.nextElementSibling;
            if (next) {
                blocksContainer.insertBefore(next, block);
                updateMoveButtons();
                updatePreview();
            }
        }

        function updateMoveButtons() {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            blocks.forEach((block, index) => {
                const upBtn = block.querySelectorAll('.move-btn')[0];
                const downBtn = block.querySelectorAll('.move-btn')[1];
                upBtn.disabled = index === 0;
                downBtn.disabled = index === blocks.length - 1;
            });
        }

        function clearAll() {
            blocksContainer.innerHTML = '';
            blockCounter = 0;
            addTextBlock();
        }

        function loadSample() {
            blocksContainer.innerHTML = '';
            blockCounter = 0;
            
            addTextBlock(`USER AUTHENTICATION SYSTEM
Technical Documentation v2.0

Introduction

This document provides a comprehensive overview of the user authentication system designed for modern web applications. The system implements industry-standard security practices and supports multiple authentication methods.

System Overview

The authentication module is built using a microservices architecture, ensuring scalability and maintainability. It handles user registration, login, session management, and access control.

Key Features

The system includes the following capabilities:
- Secure password hashing using bcrypt with configurable salt rounds
- JWT-based stateless authentication
- OAuth 2.0 integration for social login
- Two-factor authentication (2FA) support
- Rate limiting and brute force protection
- Session management with Redis

> Important: All sensitive data is encrypted at rest and in transit using AES-256 encryption.

Technical Requirements

Before implementing the system, ensure the following prerequisites are met:

1. Node.js version 18 or higher
2. MongoDB 6.0+ for user data storage
3. Redis 7.0+ for session caching
4. SSL certificate for HTTPS`);

            addCodeBlock('javascript', `const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const Redis = require('ioredis');

class AuthenticationService {
    constructor() {
        this.redis = new Redis(process.env.REDIS_URL);
        this.saltRounds = 12;
    }

    async authenticateUser(email, password) {
        // Find user in database
        const user = await User.findOne({ email });
        
        if (!user) {
            throw new AuthError('Invalid credentials', 401);
        }
        
        // Verify password
        const isValid = await bcrypt.compare(password, user.passwordHash);
        
        if (!isValid) {
            await this.recordFailedAttempt(email);
            throw new AuthError('Invalid credentials', 401);
        }
        
        // Generate JWT token
        const token = jwt.sign(
            { userId: user._id, role: user.role },
            process.env.JWT_SECRET,
            { expiresIn: '24h' }
        );
        
        // Store session in Redis
        await this.redis.setex(
            \`session:\${user._id}\`,
            86400,
            JSON.stringify({ token, loginTime: Date.now() })
        );
        
        return { token, user: user.toPublicJSON() };
    }
}`);

            addTextBlock(`Implementation Guide

Follow these steps to integrate the authentication system into your application:

Step 1: Installation

Install the required dependencies using npm or yarn. Make sure to use the exact versions specified to avoid compatibility issues.

Step 2: Configuration

Create a configuration file with your environment-specific settings. Never commit sensitive values to version control.

Step 3: Database Setup

Initialize the database schema and create the necessary indexes for optimal query performance.

> Note: The system automatically handles database migrations when starting in production mode.

Security Considerations

When deploying to production, ensure the following security measures are in place:

- Use environment variables for all secrets
- Enable HTTPS on all endpoints
- Implement proper CORS policies
- Set secure cookie attributes
- Enable audit logging

> Warning: Never expose JWT secrets or database credentials in client-side code.`);

            addCodeBlock('python', `# Python implementation for data validation
from pydantic import BaseModel, EmailStr, validator
from typing import Optional
import re

class UserRegistration(BaseModel):
    email: EmailStr
    password: str
    confirm_password: str
    full_name: str
    
    @validator('password')
    def validate_password(cls, v):
        if len(v) < 8:
            raise ValueError('Password must be at least 8 characters')
        if not re.search(r'[A-Z]', v):
            raise ValueError('Password must contain uppercase letter')
        if not re.search(r'[a-z]', v):
            raise ValueError('Password must contain lowercase letter')
        if not re.search(r'\\d', v):
            raise ValueError('Password must contain a digit')
        return v
    
    @validator('confirm_password')
    def passwords_match(cls, v, values):
        if 'password' in values and v != values['password']:
            raise ValueError('Passwords do not match')
        return v`);

            addTextBlock(`Conclusion

This authentication system provides a robust, secure, and scalable solution for user management. By following the implementation guide and security best practices outlined in this document, you can ensure a safe authentication experience for your users.

For additional support or questions, please refer to the API documentation or contact the development team.

---

Document Version: 2.0
Last Updated: January 2025
Author: Development Team`);
        }

        function updatePreview() {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            let html = '';
            let hasContent = false;

            blocks.forEach(block => {
                const type = block.dataset.type;
                const textarea = block.querySelector('textarea');
                const content = textarea.value.trim();

                if (content) {
                    hasContent = true;
                    if (type === 'text') {
                        html += renderTextHTML(parseText(content));
                    } else {
                        const lang = block.querySelector('select').value;
                        html += `
                            <div class="preview-code-block">
                                <span class="lang-label">${escapeHtml(lang)}</span>
                                <pre>${escapeHtml(content)}</pre>
                            </div>
                        `;
                    }
                }
            });

            if (!hasContent) {
                html = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <p>Start typing in any block to see preview</p>
                    </div>
                `;
            }

            document.getElementById('previewArea').innerHTML = html;
        }

        function isCommonSectionHeading(text) {
            const lower = text.toLowerCase().trim();
            return sectionKeywords.some(keyword => {
                const pattern = new RegExp(`^${keyword}$|^\\d+\\.?\\s*${keyword}$|^chapter\\s*\\d*:?\\s*${keyword}$`, 'i');
                return pattern.test(lower) || lower === keyword;
            });
        }

        function parseText(text) {
            const lines = text.split('\n');
            const content = [];
            let i = 0;

            while (i < lines.length) {
                const line = lines[i];
                const trimmed = line.trim();
                const nextLine = lines[i + 1] ? lines[i + 1].trim() : '';
                const nextNextLine = lines[i + 2] ? lines[i + 2].trim() : '';

                if (!trimmed) {
                    i++;
                    continue;
                }

                // Horizontal rule
                if (/^[-=_]{3,}$/.test(trimmed)) {
                    content.push({ type: 'hr' });
                    i++;
                    continue;
                }

                // H1: ALL CAPS (at least 3 chars, no lowercase)
                if (/^[A-Z][A-Z0-9\s\-_&.,!?:]{2,}$/.test(trimmed) && trimmed.length >= 3 && trimmed.length < 80) {
                    content.push({ type: 'h1', text: trimmed });
                    i++;
                    continue;
                }

                // H2: Numbered chapter/section heading like "1. Introduction" or "Chapter 1: Title"
                const numberedHeading = trimmed.match(/^(\d+\.?\s+|Chapter\s+\d+:?\s*)(.+)$/i);
                if (numberedHeading && numberedHeading[2].length < 60 && !trimmed.endsWith('.')) {
                    const headingText = numberedHeading[2].trim();
                    if (isCommonSectionHeading(headingText) || /^[A-Z]/.test(headingText)) {
                        content.push({ type: 'h2', text: trimmed });
                        i++;
                        continue;
                    }
                }

                // H2: Common section keywords as standalone
                if (isCommonSectionHeading(trimmed) && trimmed.length < 50) {
                    content.push({ type: 'h2', text: trimmed.charAt(0).toUpperCase() + trimmed.slice(1) });
                    i++;
                    continue;
                }

                // H2: Title Case lines (short, no ending punctuation, followed by content)
                if (/^[A-Z][a-zA-Z0-9\s\-&]+$/.test(trimmed) && 
                    trimmed.length < 50 && 
                    trimmed.length >= 3 &&
                    !/[.!?,;:]$/.test(trimmed)) {
                    const words = trimmed.split(/\s+/);
                    if (words.length <= 8) {
                        const capitalWords = words.filter(w => /^[A-Z]/.test(w)).length;
                        // At least 50% words capitalized, or it's short (1-2 words)
                        if (capitalWords >= words.length * 0.5 || words.length <= 2) {
                            // Check if followed by longer content (paragraph indicator)
                            if (!nextLine || nextLine.length > trimmed.length || nextLine === '' || 
                                /^[-*‚Ä¢\d]/.test(nextLine) || nextLine.startsWith('>')) {
                                content.push({ type: 'h2', text: trimmed });
                                i++;
                                continue;
                            }
                        }
                    }
                }

                // H3: Line ending with colon (not too long)
                if (/^[A-Za-z][A-Za-z0-9\s\-]+:$/.test(trimmed) && trimmed.length < 60) {
                    content.push({ type: 'h3', text: trimmed.slice(0, -1) });
                    i++;
                    continue;
                }

                // H3: "Step X:" pattern
                if (/^Step\s+\d+:?\s*.*/i.test(trimmed)) {
                    content.push({ type: 'h3', text: trimmed.replace(/:$/, '') });
                    i++;
                    continue;
                }

                // H4: Short line followed by much longer content (sub-subsection)
                if (trimmed.length < 40 && 
                    trimmed.length >= 3 &&
                    !trimmed.endsWith('.') && 
                    !trimmed.endsWith(',') &&
                    nextLine.length > trimmed.length * 2 &&
                    !/^[-*‚Ä¢\d>]/.test(trimmed)) {
                    content.push({ type: 'h4', text: trimmed });
                    i++;
                    continue;
                }

                // Blockquote with type detection
                if (trimmed.startsWith('>')) {
                    let quoteText = trimmed.slice(1).trim();
                    let quoteType = 'default';
                    
                    if (/^(Warning|Caution|Alert|Danger):/i.test(quoteText)) {
                        quoteType = 'warning';
                    } else if (/^(Note|Tip|Info|Hint):/i.test(quoteText)) {
                        quoteType = 'info';
                    } else if (/^(Important|Critical|Attention):/i.test(quoteText)) {
                        quoteType = 'warning';
                    } else if (/^(Success|Done|Complete):/i.test(quoteText)) {
                        quoteType = 'success';
                    }
                    
                    content.push({ type: 'blockquote', text: quoteText, quoteType: quoteType });
                    i++;
                    continue;
                }

                // Bullet list (-, *, ‚Ä¢)
                const bulletMatch = trimmed.match(/^[‚Ä¢\-\*]\s+(.+)$/);
                if (bulletMatch) {
                    const items = [];
                    while (i < lines.length) {
                        const listLine = lines[i].trim();
                        const bMatch = listLine.match(/^[‚Ä¢\-\*]\s+(.+)$/);
                        if (bMatch) {
                            items.push(bMatch[1]);
                            i++;
                        } else if (!listLine) {
                            i++;
                            break;
                        } else {
                            break;
                        }
                    }
                    content.push({ type: 'bullet-list', items: items });
                    continue;
                }

                // Numbered list (1. or 1) or a) b) c))
                const numberedMatch = trimmed.match(/^(\d+[\.\)]|[a-z][\.\)])\s+(.+)$/i);
                if (numberedMatch) {
                    const items = [];
                    const isLettered = /^[a-z][\.\)]/i.test(trimmed);
                    while (i < lines.length) {
                        const listLine = lines[i].trim();
                        const nMatch = listLine.match(/^(\d+[\.\)]|[a-z][\.\)])\s+(.+)$/i);
                        if (nMatch) {
                            items.push(nMatch[2]);
                            i++;
                        } else if (!listLine) {
                            i++;
                            break;
                        } else {
                            break;
                        }
                    }
                    content.push({ type: 'numbered-list', items: items, lettered: isLettered });
                    continue;
                }

                // Regular paragraph with inline formatting
                content.push({ type: 'paragraph', text: trimmed });
                i++;
            }

            return content;
        }

        function formatInlineText(text) {
            // Bold **text**
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            // Italic *text*
            text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
            // Escape HTML but preserve our formatting
            return text;
        }

        function renderTextHTML(content) {
            return content.map(item => {
                const formattedText = item.text ? formatInlineText(escapeHtml(item.text)) : '';
                
                switch (item.type) {
                    case 'h1':
                        return `<h1>${formattedText}</h1>`;
                    case 'h2':
                        return `<h2>${formattedText}</h2>`;
                    case 'h3':
                        return `<h3>${formattedText}</h3>`;
                    case 'h4':
                        return `<h4>${formattedText}</h4>`;
                    case 'paragraph':
                        return `<p>${formattedText}</p>`;
                    case 'hr':
                        return `<hr>`;
                    case 'blockquote':
                        const quoteClass = item.quoteType === 'warning' ? ' warning' : 
                                          item.quoteType === 'success' ? ' success' : '';
                        return `<blockquote class="${quoteClass}">${formattedText}</blockquote>`;
                    case 'bullet-list':
                        return `<ul>${item.items.map(i => `<li>${formatInlineText(escapeHtml(i))}</li>`).join('')}</ul>`;
                    case 'numbered-list':
                        const tag = item.lettered ? 'ol type="a"' : 'ol';
                        return `<${tag}>${item.items.map(i => `<li>${formatInlineText(escapeHtml(i))}</li>`).join('')}</ol>`;
                    default:
                        return '';
                }
            }).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function exportToDoc() {
            try {
                const blocks = blocksContainer.querySelectorAll('.content-block');
                let hasContent = false;

                blocks.forEach(block => {
                    if (block.querySelector('textarea').value.trim()) {
                        hasContent = true;
                    }
                });

                if (!hasContent) {
                    showToast('Please add some content first!', true);
                    return;
                }

                if (typeof docx === 'undefined') {
                    showToast('Library not loaded. Please refresh.', true);
                    return;
                }

                const { Document, Packer, Paragraph, TextRun, HeadingLevel, BorderStyle, ShadingType, Table, TableRow, TableCell, WidthType, AlignmentType } = docx;
                const docChildren = [];

                blocks.forEach(block => {
                    const type = block.dataset.type;
                    const content = block.querySelector('textarea').value.trim();

                    if (!content) return;

                    if (type === 'text') {
                        const textContent = parseText(content);
                        
                        for (const item of textContent) {
                            switch (item.type) {
                                case 'h1':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 52, font: 'Arial', color: '1a1a2e' })],
                                        heading: HeadingLevel.HEADING_1,
                                        spacing: { before: 400, after: 240 },
                                        border: { bottom: { style: BorderStyle.SINGLE, size: 12, color: '667eea' } }
                                    }));
                                    break;
                                case 'h2':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 36, font: 'Arial', color: '302b63' })],
                                        heading: HeadingLevel.HEADING_2,
                                        spacing: { before: 360, after: 180 },
                                        border: { bottom: { style: BorderStyle.SINGLE, size: 6, color: 'CCCCCC' } }
                                    }));
                                    break;
                                case 'h3':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 28, font: 'Arial', color: '24243e' })],
                                        heading: HeadingLevel.HEADING_3,
                                        spacing: { before: 280, after: 140 }
                                    }));
                                    break;
                                case 'h4':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, italics: true, size: 24, font: 'Arial', color: '444444' })],
                                        spacing: { before: 240, after: 120 }
                                    }));
                                    break;
                                case 'paragraph':
                                    docChildren.push(new Paragraph({
                                        children: parseInlineText(item.text),
                                        spacing: { after: 200, line: 360 },
                                        alignment: AlignmentType.JUSTIFIED
                                    }));
                                    break;
                                case 'hr':
                                    docChildren.push(new Paragraph({
                                        children: [],
                                        border: { bottom: { style: BorderStyle.SINGLE, size: 6, color: 'CCCCCC' } },
                                        spacing: { before: 300, after: 300 }
                                    }));
                                    break;
                                case 'blockquote':
                                    const borderColor = item.quoteType === 'warning' ? 'ff6b6b' : 
                                                       item.quoteType === 'success' ? '00d9a4' : '667eea';
                                    const bgColor = item.quoteType === 'warning' ? 'FFF5F5' : 
                                                   item.quoteType === 'success' ? 'F0FFF9' : 'F8F7FF';
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, size: 24, italics: true, color: '555555', font: 'Arial' })],
                                        border: { left: { style: BorderStyle.SINGLE, size: 24, color: borderColor } },
                                        shading: { fill: bgColor, type: ShadingType.CLEAR },
                                        indent: { left: 720 },
                                        spacing: { before: 240, after: 240 }
                                    }));
                                    break;
                                case 'bullet-list':
                                    item.items.forEach(listItem => {
                                        docChildren.push(new Paragraph({
                                            children: [
                                                new TextRun({ text: '‚Ä¢  ', size: 24, font: 'Arial' }),
                                                ...parseInlineText(listItem)
                                            ],
                                            indent: { left: 720 },
                                            spacing: { after: 100 }
                                        }));
                                    });
                                    docChildren.push(new Paragraph({ children: [], spacing: { after: 120 } }));
                                    break;
                                case 'numbered-list':
                                    item.items.forEach((listItem, idx) => {
                                        const prefix = item.lettered ? 
                                            String.fromCharCode(97 + idx) + ')  ' : 
                                            `${idx + 1}.  `;
                                        docChildren.push(new Paragraph({
                                            children: [
                                                new TextRun({ text: prefix, size: 24, font: 'Arial' }),
                                                ...parseInlineText(listItem)
                                            ],
                                            indent: { left: 720 },
                                            spacing: { after: 100 }
                                        }));
                                    });
                                    docChildren.push(new Paragraph({ children: [], spacing: { after: 120 } }));
                                    break;
                            }
                        }
                    } else {
                        // Code block with dark background using Table
                        const lang = block.querySelector('select').value;
                        const codeLines = content.split('\n');
                        
                        const codeParagraphs = [];
                        
                        // Language label
                        codeParagraphs.push(new Paragraph({
                            children: [new TextRun({
                                text: lang.toUpperCase(),
                                font: 'Consolas',
                                size: 18,
                                bold: true,
                                color: 'F093FB'
                            })],
                            spacing: { after: 150 }
                        }));
                        
                        // Code lines
                        codeLines.forEach((line, idx) => {
                            codeParagraphs.push(new Paragraph({
                                children: [new TextRun({
                                    text: line || ' ',
                                    font: 'Consolas',
                                    size: 20,
                                    color: 'D4D4D4'
                                })],
                                spacing: { after: idx === codeLines.length - 1 ? 0 : 40 }
                            }));
                        });
                        
                        // Table with dark background
                        const codeTable = new Table({
                            width: { size: 100, type: WidthType.PERCENTAGE },
                            rows: [
                                new TableRow({
                                    children: [
                                        new TableCell({
                                            children: codeParagraphs,
                                            shading: { fill: '1E1E1E', type: ShadingType.CLEAR },
                                            margins: { top: 200, bottom: 200, left: 300, right: 300 },
                                            borders: {
                                                top: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                bottom: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                right: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                left: { style: BorderStyle.SINGLE, size: 24, color: 'F093FB' }
                                            }
                                        })
                                    ]
                                })
                            ]
                        });
                        
                        docChildren.push(new Paragraph({ children: [], spacing: { before: 240 } }));
                        docChildren.push(codeTable);
                        docChildren.push(new Paragraph({ children: [], spacing: { after: 240 } }));
                    }
                });

                // Helper function to parse inline formatting
                function parseInlineText(text) {
                    const runs = [];
                    const regex = /(\*\*(.+?)\*\*)|(\*(.+?)\*)/g;
                    let lastIndex = 0;
                    let match;

                    while ((match = regex.exec(text)) !== null) {
                        if (match.index > lastIndex) {
                            runs.push(new TextRun({ text: text.slice(lastIndex, match.index), size: 24, font: 'Arial' }));
                        }

                        if (match[1]) {
                            runs.push(new TextRun({ text: match[2], bold: true, size: 24, font: 'Arial' }));
                        } else if (match[3]) {
                            runs.push(new TextRun({ text: match[4], italics: true, size: 24, font: 'Arial' }));
                        }

                        lastIndex = regex.lastIndex;
                    }

                    if (lastIndex < text.length) {
                        runs.push(new TextRun({ text: text.slice(lastIndex), size: 24, font: 'Arial' }));
                    }

                    if (runs.length === 0) {
                        runs.push(new TextRun({ text: text, size: 24, font: 'Arial' }));
                    }

                    return runs;
                }

                const doc = new Document({
                    styles: { 
                        default: { 
                            document: { 
                                run: { font: 'Arial', size: 24 } 
                            } 
                        } 
                    },
                    sections: [{
                        properties: {
                            page: {
                                size: { width: 12240, height: 15840 },
                                margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
                            }
                        },
                        children: docChildren
                    }]
                });

                const blob = await Packer.toBlob(doc);
                saveAs(blob, 'professional-document.docx');
                showToast('Document exported successfully!');

            } catch (error) {
                console.error('Export error:', error);
                showToast('Export failed: ' + error.message, true);
            }
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
