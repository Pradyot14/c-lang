<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flexible Text & Code Formatter</title>
    <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.3rem;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #888;
            font-size: 1rem;
        }

        /* Quick Reference Bar */
        .quick-reference {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .quick-reference-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .quick-reference-title {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-reference-toggle {
            color: #667eea;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quick-reference-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(102, 126, 234, 0.2);
        }

        .quick-reference-content.show {
            display: block;
        }

        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .command-group {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .command-group h4 {
            color: #f093fb;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .command-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .command-item:last-child {
            margin-bottom: 0;
        }

        .command-syntax {
            background: rgba(240, 147, 251, 0.15);
            color: #f093fb;
            padding: 3px 8px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            white-space: nowrap;
            min-width: fit-content;
        }

        .command-desc {
            color: #aaa;
            line-height: 1.4;
        }

        .command-result {
            color: #00ff88;
            font-size: 11px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel.preview-panel {
            border-left: 4px solid #00ff88;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .panel-title {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #00ff88;
        }

        .panel-title svg {
            width: 22px;
            height: 22px;
        }

        /* Content Block Styles */
        .content-block {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: all 0.3s;
        }

        .content-block:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .content-block.text-block {
            border-left: 4px solid #667eea;
        }

        .content-block.code-block {
            border-left: 4px solid #f093fb;
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .block-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .block-label.text-label {
            color: #667eea;
        }

        .block-label.code-label {
            color: #f093fb;
        }

        .block-label svg {
            width: 16px;
            height: 16px;
        }

        .block-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .block-actions select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 5px 10px;
            color: #e0e0e0;
            font-size: 12px;
            cursor: pointer;
        }

        .block-actions select:focus {
            outline: none;
            border-color: #f093fb;
        }

        .move-btn, .remove-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .move-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }

        .remove-btn:hover {
            background: rgba(255, 71, 87, 0.3);
            color: #ff4757;
        }

        .move-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            color: #e0e0e0;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
        }

        .text-block textarea {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 180px;
        }

        .text-block textarea:focus {
            border-color: #667eea;
        }

        .code-block textarea {
            font-family: 'Consolas', 'Monaco', 'Fira Code', monospace;
            height: 150px;
        }

        .code-block textarea:focus {
            border-color: #f093fb;
        }

        textarea::placeholder {
            color: #555;
        }

        /* Add Block Buttons */
        .add-block-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
        }

        .add-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn svg {
            width: 18px;
            height: 18px;
        }

        .add-text-btn {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .add-text-btn:hover {
            background: rgba(102, 126, 234, 0.35);
            transform: translateY(-2px);
        }

        .add-code-btn {
            background: rgba(240, 147, 251, 0.2);
            color: #f093fb;
            border: 1px solid rgba(240, 147, 251, 0.3);
        }

        .add-code-btn:hover {
            background: rgba(240, 147, 251, 0.35);
            transform: translateY(-2px);
        }

        /* Preview Area */
        .preview-area {
            width: 100%;
            min-height: 500px;
            max-height: 700px;
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            color: #333;
            overflow-y: auto;
        }

        .preview-area h1 {
            font-size: 1.8rem;
            color: #1a1a2e;
            -webkit-text-fill-color: #1a1a2e;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .preview-area h2 {
            font-size: 1.4rem;
            color: #302b63;
            margin: 25px 0 12px 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 6px;
        }

        .preview-area h3 {
            font-size: 1.15rem;
            color: #24243e;
            margin: 20px 0 10px 0;
        }

        .preview-area p {
            margin-bottom: 14px;
            line-height: 1.75;
        }

        .preview-area .preview-code-block {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            border-left: 5px solid #f093fb;
        }

        .preview-area .preview-code-block pre {
            margin: 0;
            font-family: 'Consolas', 'Monaco', 'Fira Code', monospace;
            font-size: 13px;
            color: #d4d4d4;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .preview-area .preview-code-block .lang-label {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: #fff;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            margin-bottom: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-area ul, .preview-area ol {
            margin: 12px 0 12px 28px;
        }

        .preview-area li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .preview-area blockquote {
            border-left: 4px solid #667eea;
            padding: 12px 18px;
            margin: 18px 0;
            color: #555;
            font-style: italic;
            background: #f8f7ff;
            border-radius: 0 10px 10px 0;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 70px;
            height: 70px;
            margin-bottom: 15px;
            opacity: 0.4;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
        }

        .block-number {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        .scroll-hint {
            text-align: center;
            color: #666;
            font-size: 11px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÑ Flexible Text & Code Formatter</h1>
            <p class="subtitle">Add text and code blocks in any order ‚Üí Export to Word</p>
        </header>

        <!-- Quick Reference Section -->
        <div class="quick-reference">
            <div class="quick-reference-header" onclick="toggleReference()">
                <span class="quick-reference-title">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    üìñ Formatting Commands Reference
                </span>
                <span class="quick-reference-toggle">
                    <span id="toggleText">Show Commands</span>
                    <svg id="toggleIcon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="transition: transform 0.3s;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </span>
            </div>
            <div class="quick-reference-content" id="referenceContent">
                <div class="commands-grid">
                    <!-- Headings -->
                    <div class="command-group">
                        <h4>üìå Headings</h4>
                        <div class="command-item">
                            <span class="command-syntax">ALL CAPS TEXT</span>
                            <span class="command-desc">Main heading (H1)<br><span class="command-result">‚Üí Large bold title</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">Title Case Text</span>
                            <span class="command-desc">Subheading (H2)<br><span class="command-result">‚Üí Section header</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">Text with colon:</span>
                            <span class="command-desc">Section title (H3)<br><span class="command-result">‚Üí Smaller heading</span></span>
                        </div>
                    </div>

                    <!-- Lists -->
                    <div class="command-group">
                        <h4>üìù Lists</h4>
                        <div class="command-item">
                            <span class="command-syntax">- Item text</span>
                            <span class="command-desc">Bullet point<br><span class="command-result">‚Üí ‚Ä¢ Item text</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">* Item text</span>
                            <span class="command-desc">Bullet point (alt)<br><span class="command-result">‚Üí ‚Ä¢ Item text</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">1. First item</span>
                            <span class="command-desc">Numbered list<br><span class="command-result">‚Üí 1. First item</span></span>
                        </div>
                    </div>

                    <!-- Quotes & Special -->
                    <div class="command-group">
                        <h4>üí¨ Quotes & Notes</h4>
                        <div class="command-item">
                            <span class="command-syntax">> Quote text</span>
                            <span class="command-desc">Blockquote / Important note<br><span class="command-result">‚Üí Highlighted quote box</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">> Important: ...</span>
                            <span class="command-desc">Callout / Warning<br><span class="command-result">‚Üí Styled callout</span></span>
                        </div>
                        <div class="command-item">
                            <span class="command-syntax">> Note: ...</span>
                            <span class="command-desc">Information note<br><span class="command-result">‚Üí Info box</span></span>
                        </div>
                    </div>

                    <!-- Examples -->
                    <div class="command-group">
                        <h4>‚ú® Examples</h4>
                        <div class="command-item" style="flex-direction: column; gap: 5px;">
                            <code style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; display: block; font-size: 11px; color: #ccc; white-space: pre-wrap;">PROJECT TITLE

Introduction

This is a paragraph of text.

Key Points:

- First bullet point
- Second bullet point

1. Step one
2. Step two

> Important: This is a highlighted note.</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Input Section -->
            <div class="input-section">
                <div class="panel" style="padding: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="color: #888; font-size: 13px;">üìã Content Blocks</span>
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="clearAll()" style="padding: 6px 12px; font-size: 12px;">
                                Clear All
                            </button>
                            <button class="btn btn-secondary" onclick="loadSample()" style="padding: 6px 12px; font-size: 12px;">
                                Load Sample
                            </button>
                        </div>
                    </div>
                </div>

                <div id="blocksContainer">
                    <!-- Dynamic blocks will be added here -->
                </div>

                <div class="add-block-container">
                    <button class="add-btn add-text-btn" onclick="addTextBlock()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Text Block
                    </button>
                    <button class="add-btn add-code-btn" onclick="addCodeBlock()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add Code Block
                    </button>
                </div>

                <p class="scroll-hint">‚Üï Scroll to see all blocks</p>
            </div>

            <!-- Preview Section -->
            <div class="panel preview-panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        Live Preview
                    </span>
                    <button class="btn btn-primary" onclick="exportToDoc()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        Export .DOCX
                    </button>
                </div>
                <div class="preview-area" id="previewArea">
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <p>Click "Add Text Block" or "Add Code Block" to start</p>
                        <p style="font-size: 12px; color: #777;">Blocks appear in the order you add them</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let blockCounter = 0;
        const blocksContainer = document.getElementById('blocksContainer');

        // Toggle reference panel
        function toggleReference() {
            const content = document.getElementById('referenceContent');
            const toggleText = document.getElementById('toggleText');
            const toggleIcon = document.getElementById('toggleIcon');
            
            content.classList.toggle('show');
            
            if (content.classList.contains('show')) {
                toggleText.textContent = 'Hide Commands';
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                toggleText.textContent = 'Show Commands';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize with one text block
        window.addEventListener('load', () => {
            addTextBlock();
        });

        function addTextBlock(content = '') {
            blockCounter++;
            const blockId = blockCounter;
            
            const block = document.createElement('div');
            block.className = 'content-block text-block';
            block.dataset.id = blockId;
            block.dataset.type = 'text';
            block.innerHTML = `
                <div class="block-header">
                    <span class="block-label text-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Text Block
                        <span class="block-number">#${blockId}</span>
                    </span>
                    <div class="block-actions">
                        <button class="move-btn" onclick="moveBlockUp(this)" title="Move Up">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                            </svg>
                        </button>
                        <button class="move-btn" onclick="moveBlockDown(this)" title="Move Down">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <button class="remove-btn" onclick="removeBlock(this)" title="Remove">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <textarea placeholder="Type your text here...

Commands:
ALL CAPS ‚Üí Heading 1
Title Case ‚Üí Heading 2  
Text with colon: ‚Üí Heading 3
- or * ‚Üí Bullet list
1. 2. 3. ‚Üí Numbered list
> text ‚Üí Blockquote/Note" oninput="updatePreview()">${content}</textarea>
            `;
            
            blocksContainer.appendChild(block);
            updateMoveButtons();
            updatePreview();
            
            block.querySelector('textarea').focus();
        }

        function addCodeBlock(lang = 'javascript', content = '') {
            blockCounter++;
            const blockId = blockCounter;
            
            const block = document.createElement('div');
            block.className = 'content-block code-block';
            block.dataset.id = blockId;
            block.dataset.type = 'code';
            block.innerHTML = `
                <div class="block-header">
                    <span class="block-label code-label">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                        </svg>
                        Code Block
                        <span class="block-number">#${blockId}</span>
                    </span>
                    <div class="block-actions">
                        <select onchange="updatePreview()">
                            <option value="javascript" ${lang === 'javascript' ? 'selected' : ''}>JavaScript</option>
                            <option value="python" ${lang === 'python' ? 'selected' : ''}>Python</option>
                            <option value="java" ${lang === 'java' ? 'selected' : ''}>Java</option>
                            <option value="cpp" ${lang === 'cpp' ? 'selected' : ''}>C++</option>
                            <option value="c" ${lang === 'c' ? 'selected' : ''}>C</option>
                            <option value="csharp" ${lang === 'csharp' ? 'selected' : ''}>C#</option>
                            <option value="html" ${lang === 'html' ? 'selected' : ''}>HTML</option>
                            <option value="css" ${lang === 'css' ? 'selected' : ''}>CSS</option>
                            <option value="sql" ${lang === 'sql' ? 'selected' : ''}>SQL</option>
                            <option value="bash" ${lang === 'bash' ? 'selected' : ''}>Bash</option>
                            <option value="json" ${lang === 'json' ? 'selected' : ''}>JSON</option>
                            <option value="typescript" ${lang === 'typescript' ? 'selected' : ''}>TypeScript</option>
                            <option value="php" ${lang === 'php' ? 'selected' : ''}>PHP</option>
                            <option value="ruby" ${lang === 'ruby' ? 'selected' : ''}>Ruby</option>
                            <option value="go" ${lang === 'go' ? 'selected' : ''}>Go</option>
                            <option value="rust" ${lang === 'rust' ? 'selected' : ''}>Rust</option>
                            <option value="swift" ${lang === 'swift' ? 'selected' : ''}>Swift</option>
                            <option value="kotlin" ${lang === 'kotlin' ? 'selected' : ''}>Kotlin</option>
                            <option value="code" ${lang === 'code' ? 'selected' : ''}>Other</option>
                        </select>
                        <button class="move-btn" onclick="moveBlockUp(this)" title="Move Up">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                            </svg>
                        </button>
                        <button class="move-btn" onclick="moveBlockDown(this)" title="Move Down">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <button class="remove-btn" onclick="removeBlock(this)" title="Remove">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <textarea placeholder="Paste your code here..." oninput="updatePreview()">${content}</textarea>
            `;
            
            blocksContainer.appendChild(block);
            updateMoveButtons();
            updatePreview();
            
            block.querySelector('textarea').focus();
        }

        function removeBlock(btn) {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            if (blocks.length > 1) {
                btn.closest('.content-block').remove();
                updateMoveButtons();
                updatePreview();
            } else {
                showToast('Need at least one block', true);
            }
        }

        function moveBlockUp(btn) {
            const block = btn.closest('.content-block');
            const prev = block.previousElementSibling;
            if (prev) {
                blocksContainer.insertBefore(block, prev);
                updateMoveButtons();
                updatePreview();
            }
        }

        function moveBlockDown(btn) {
            const block = btn.closest('.content-block');
            const next = block.nextElementSibling;
            if (next) {
                blocksContainer.insertBefore(next, block);
                updateMoveButtons();
                updatePreview();
            }
        }

        function updateMoveButtons() {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            blocks.forEach((block, index) => {
                const upBtn = block.querySelectorAll('.move-btn')[0];
                const downBtn = block.querySelectorAll('.move-btn')[1];
                upBtn.disabled = index === 0;
                downBtn.disabled = index === blocks.length - 1;
            });
        }

        function clearAll() {
            blocksContainer.innerHTML = '';
            blockCounter = 0;
            addTextBlock();
        }

        function loadSample() {
            blocksContainer.innerHTML = '';
            blockCounter = 0;
            
            addTextBlock(`PROJECT DOCUMENTATION

Overview

This document describes the implementation of a user authentication system. The system provides secure login and session management for web applications.

Key Features:

The module includes the following capabilities:
- Secure password hashing with bcrypt
- JWT token based sessions
- Rate limiting protection
- Two-factor authentication support

> Important: Always use HTTPS in production to protect credentials in transit.`);

            addCodeBlock('javascript', `const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');

async function authenticateUser(email, password) {
    const user = await User.findOne({ email });
    
    if (!user) {
        throw new Error('User not found');
    }
    
    const isValid = await bcrypt.compare(password, user.password);
    
    if (!isValid) {
        throw new Error('Invalid password');
    }
    
    const token = jwt.sign(
        { userId: user._id },
        process.env.JWT_SECRET,
        { expiresIn: '24h' }
    );
    
    return { token, user };
}`);

            addTextBlock(`Implementation Steps:

The authentication flow works as follows:

1. User submits email and password
2. Server validates credentials against database
3. If valid, JWT token is generated
4. Token is returned to client

> Note: Token expiration is set to 24 hours by default.`);

            addCodeBlock('python', `# Python implementation
import jwt
import bcrypt
from datetime import datetime, timedelta

def authenticate_user(email: str, password: str) -> dict:
    """Authenticate user and return JWT token."""
    user = User.query.filter_by(email=email).first()
    
    if not user:
        raise ValueError("User not found")
    
    if not bcrypt.checkpw(password.encode(), user.password_hash):
        raise ValueError("Invalid password")
    
    token = jwt.encode({
        'user_id': user.id,
        'exp': datetime.utcnow() + timedelta(hours=24)
    }, SECRET_KEY, algorithm='HS256')
    
    return {'token': token, 'user': user.to_dict()}`);

            addTextBlock(`CONCLUSION

This authentication system provides a robust foundation for user management with modern security practices. Both JavaScript and Python implementations are provided above.

> Security Note: Remember to store JWT secrets securely and never expose them in client-side code.`);
        }

        function updatePreview() {
            const blocks = blocksContainer.querySelectorAll('.content-block');
            let html = '';
            let hasContent = false;

            blocks.forEach(block => {
                const type = block.dataset.type;
                const textarea = block.querySelector('textarea');
                const content = textarea.value.trim();

                if (content) {
                    hasContent = true;
                    if (type === 'text') {
                        html += renderTextHTML(parseText(content));
                    } else {
                        const lang = block.querySelector('select').value;
                        html += `
                            <div class="preview-code-block">
                                <span class="lang-label">${escapeHtml(lang)}</span>
                                <pre>${escapeHtml(content)}</pre>
                            </div>
                        `;
                    }
                }
            });

            if (!hasContent) {
                html = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <p>Start typing in any block to see preview</p>
                    </div>
                `;
            }

            document.getElementById('previewArea').innerHTML = html;
        }

        function parseText(text) {
            const lines = text.split('\n');
            const content = [];
            let i = 0;

            while (i < lines.length) {
                const line = lines[i];
                const trimmed = line.trim();

                if (!trimmed) {
                    i++;
                    continue;
                }

                // ALL CAPS = H1
                if (/^[A-Z][A-Z\s]{2,}$/.test(trimmed) && trimmed.length < 60) {
                    content.push({ type: 'h1', text: trimmed });
                    i++;
                    continue;
                }

                // Title Case = H2
                if (/^[A-Z][a-zA-Z\s]+$/.test(trimmed) && trimmed.length < 50 && !/[.!?,;]$/.test(trimmed)) {
                    const words = trimmed.split(/\s+/);
                    if (words.length >= 1 && words.length <= 8) {
                        const capitalWords = words.filter(w => /^[A-Z]/.test(w)).length;
                        if (capitalWords >= words.length * 0.5) {
                            content.push({ type: 'h2', text: trimmed });
                            i++;
                            continue;
                        }
                    }
                }

                // Line ending with colon = H3
                if (/^[A-Za-z][A-Za-z\s]+:$/.test(trimmed) && trimmed.length < 50) {
                    content.push({ type: 'h3', text: trimmed.slice(0, -1) });
                    i++;
                    continue;
                }

                // Blockquote
                if (trimmed.startsWith('>')) {
                    content.push({ type: 'blockquote', text: trimmed.slice(1).trim() });
                    i++;
                    continue;
                }

                // Bullet list
                const bulletMatch = trimmed.match(/^[‚Ä¢\-\*]\s+(.+)$/);
                if (bulletMatch) {
                    const items = [];
                    while (i < lines.length) {
                        const listLine = lines[i].trim();
                        const bMatch = listLine.match(/^[‚Ä¢\-\*]\s+(.+)$/);
                        if (bMatch) {
                            items.push(bMatch[1]);
                            i++;
                        } else if (!listLine) {
                            i++;
                            break;
                        } else {
                            break;
                        }
                    }
                    content.push({ type: 'bullet-list', items: items });
                    continue;
                }

                // Numbered list
                const numberedMatch = trimmed.match(/^\d+[\.\)]\s+(.+)$/);
                if (numberedMatch) {
                    const items = [];
                    while (i < lines.length) {
                        const listLine = lines[i].trim();
                        const nMatch = listLine.match(/^\d+[\.\)]\s+(.+)$/);
                        if (nMatch) {
                            items.push(nMatch[1]);
                            i++;
                        } else if (!listLine) {
                            i++;
                            break;
                        } else {
                            break;
                        }
                    }
                    content.push({ type: 'numbered-list', items: items });
                    continue;
                }

                // Regular paragraph
                content.push({ type: 'paragraph', text: trimmed });
                i++;
            }

            return content;
        }

        function renderTextHTML(content) {
            return content.map(item => {
                switch (item.type) {
                    case 'h1':
                        return `<h1>${escapeHtml(item.text)}</h1>`;
                    case 'h2':
                        return `<h2>${escapeHtml(item.text)}</h2>`;
                    case 'h3':
                        return `<h3>${escapeHtml(item.text)}</h3>`;
                    case 'paragraph':
                        return `<p>${escapeHtml(item.text)}</p>`;
                    case 'blockquote':
                        return `<blockquote>${escapeHtml(item.text)}</blockquote>`;
                    case 'bullet-list':
                        return `<ul>${item.items.map(i => `<li>${escapeHtml(i)}</li>`).join('')}</ul>`;
                    case 'numbered-list':
                        return `<ol>${item.items.map(i => `<li>${escapeHtml(i)}</li>`).join('')}</ol>`;
                    default:
                        return '';
                }
            }).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function exportToDoc() {
            try {
                const blocks = blocksContainer.querySelectorAll('.content-block');
                let hasContent = false;

                blocks.forEach(block => {
                    if (block.querySelector('textarea').value.trim()) {
                        hasContent = true;
                    }
                });

                if (!hasContent) {
                    showToast('Please add some content first!', true);
                    return;
                }

                if (typeof docx === 'undefined') {
                    showToast('Library not loaded. Please refresh.', true);
                    return;
                }

                const { Document, Packer, Paragraph, TextRun, HeadingLevel, BorderStyle, ShadingType, Table, TableRow, TableCell, WidthType } = docx;
                const docChildren = [];

                blocks.forEach(block => {
                    const type = block.dataset.type;
                    const content = block.querySelector('textarea').value.trim();

                    if (!content) return;

                    if (type === 'text') {
                        const textContent = parseText(content);
                        
                        for (const item of textContent) {
                            switch (item.type) {
                                case 'h1':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 48, font: 'Arial' })],
                                        heading: HeadingLevel.HEADING_1,
                                        spacing: { before: 400, after: 200 }
                                    }));
                                    break;
                                case 'h2':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 36, font: 'Arial' })],
                                        heading: HeadingLevel.HEADING_2,
                                        spacing: { before: 300, after: 150 }
                                    }));
                                    break;
                                case 'h3':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, bold: true, size: 28, font: 'Arial' })],
                                        heading: HeadingLevel.HEADING_3,
                                        spacing: { before: 200, after: 100 }
                                    }));
                                    break;
                                case 'paragraph':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, size: 24, font: 'Arial' })],
                                        spacing: { after: 200 }
                                    }));
                                    break;
                                case 'blockquote':
                                    docChildren.push(new Paragraph({
                                        children: [new TextRun({ text: item.text, size: 24, italics: true, color: '555555', font: 'Arial' })],
                                        border: { left: { style: BorderStyle.SINGLE, size: 24, color: '667eea' } },
                                        shading: { fill: 'F8F7FF', type: ShadingType.CLEAR },
                                        indent: { left: 720 },
                                        spacing: { before: 200, after: 200 }
                                    }));
                                    break;
                                case 'bullet-list':
                                    item.items.forEach(listItem => {
                                        docChildren.push(new Paragraph({
                                            children: [
                                                new TextRun({ text: '‚Ä¢  ', size: 24, font: 'Arial' }),
                                                new TextRun({ text: listItem, size: 24, font: 'Arial' })
                                            ],
                                            indent: { left: 720 },
                                            spacing: { after: 80 }
                                        }));
                                    });
                                    docChildren.push(new Paragraph({ children: [] }));
                                    break;
                                case 'numbered-list':
                                    item.items.forEach((listItem, idx) => {
                                        docChildren.push(new Paragraph({
                                            children: [
                                                new TextRun({ text: `${idx + 1}.  `, size: 24, font: 'Arial' }),
                                                new TextRun({ text: listItem, size: 24, font: 'Arial' })
                                            ],
                                            indent: { left: 720 },
                                            spacing: { after: 80 }
                                        }));
                                    });
                                    docChildren.push(new Paragraph({ children: [] }));
                                    break;
                            }
                        }
                    } else {
                        // Code block with dark background using Table
                        const lang = block.querySelector('select').value;
                        const codeLines = content.split('\n');
                        
                        // Create code content paragraphs for inside the table cell
                        const codeParagraphs = [];
                        
                        // Language label paragraph
                        codeParagraphs.push(new Paragraph({
                            children: [new TextRun({
                                text: lang.toUpperCase(),
                                font: 'Consolas',
                                size: 18,
                                bold: true,
                                color: 'F093FB'
                            })],
                            spacing: { after: 150 }
                        }));
                        
                        // Code lines
                        codeLines.forEach((line, idx) => {
                            codeParagraphs.push(new Paragraph({
                                children: [new TextRun({
                                    text: line || ' ',
                                    font: 'Consolas',
                                    size: 20,
                                    color: 'D4D4D4'  // Light gray text for dark bg
                                })],
                                spacing: { after: idx === codeLines.length - 1 ? 0 : 40 }
                            }));
                        });
                        
                        // Create table with dark background
                        const codeTable = new Table({
                            width: { size: 100, type: WidthType.PERCENTAGE },
                            rows: [
                                new TableRow({
                                    children: [
                                        new TableCell({
                                            children: codeParagraphs,
                                            shading: { fill: '1E1E1E', type: ShadingType.CLEAR },  // Dark background
                                            margins: {
                                                top: 200,
                                                bottom: 200,
                                                left: 300,
                                                right: 300
                                            },
                                            borders: {
                                                top: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                bottom: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                right: { style: BorderStyle.NONE, size: 0, color: '1E1E1E' },
                                                left: { style: BorderStyle.SINGLE, size: 24, color: 'F093FB' }  // Pink left border
                                            }
                                        })
                                    ]
                                })
                            ]
                        });
                        
                        // Add spacing before code block
                        docChildren.push(new Paragraph({ children: [], spacing: { before: 200 } }));
                        docChildren.push(codeTable);
                        // Add spacing after code block
                        docChildren.push(new Paragraph({ children: [], spacing: { after: 200 } }));
                    }
                });

                const doc = new Document({
                    styles: { default: { document: { run: { font: 'Arial', size: 24 } } } },
                    sections: [{
                        properties: {
                            page: {
                                size: { width: 12240, height: 15840 },
                                margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
                            }
                        },
                        children: docChildren
                    }]
                });

                const blob = await Packer.toBlob(doc);
                saveAs(blob, 'formatted-document.docx');
                showToast('Document exported successfully!');

            } catch (error) {
                console.error('Export error:', error);
                showToast('Export failed: ' + error.message, true);
            }
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
